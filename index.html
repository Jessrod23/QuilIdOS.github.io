<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel de Seguridad - Clientes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0e1a2b;
      color: #f1f1f1;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #00d1b2;
    }
    .panel {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .cliente {
      background-color: #1e2b3c;
      border: 2px solid #00d1b2;
      border-radius: 10px;
      padding: 20px;
      width: 250px;
      box-shadow: 0 0 15px rgba(0, 209, 178, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .cliente h2 {
      margin-top: 0;
      color: #ffffff;
      text-align: center;
    }
    .estado {
      font-weight: bold;
      margin: 10px 0;
    }
    .conectado {
      color: #00ff88;
    }
    .desconectado {
      color: #ff4e4e;
    }
    .aviso {
      background-color: #ffcc00;
      color: #000;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 10px;
      text-align: center;
    }
    .boton-conectar {
      background-color: #00d1b2;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      width: 100%;
      transition: background-color 0.3s ease;
    }
    .boton-conectar:hover:not(:disabled) {
      background-color: #00b89c;
    }
    .boton-conectar:disabled {
      background-color: #00785a;
      cursor: default;
    }
  </style>
</head>
<body>
  <h1>Panel de Monitoreo de Seguridad</h1>
  <div class="panel" id="panel-clientes"></div>

  <script>
    const clientes = [
      { id: 'julied', nombre: 'Julied', conectado: true, aviso: '' },
      { id: 'gabriel', nombre: 'Gabriel', conectado: false, aviso: '⚠ Tiene 2 días para pagar' },
      { id: 'jose', nombre: 'José Antonio', conectado: false, aviso: '⚠ Tiene 2 días para pagar' },
      { id: 'sofia', nombre: 'Sofía', conectado: true, aviso: '' },
      { id: 'mario', nombre: 'Mario', conectado: false, aviso: '' },
      { id: 'valeria', nombre: 'Valeria', conectado: true, aviso: '' },
      { id: 'carlos', nombre: 'Carlos', conectado: false, aviso: '' },
      { id: 'ana', nombre: 'Ana', conectado: true, aviso: '' },
      { id: 'diego', nombre: 'Diego', conectado: false, aviso: '⚠ Tiene 5 días para pagar' },
      { id: 'marcela', nombre: 'Marcela', conectado: false, aviso: '' },
      { id: 'luis', nombre: 'Luis', conectado: true, aviso: '' },
      { id: 'laura', nombre: 'Laura', conectado: false, aviso: '' },
      { id: 'pablo', nombre: 'Pablo', conectado: true, aviso: '' },
      { id: 'andrea', nombre: 'Andrea', conectado: false, aviso: '' },
      { id: 'fernando', nombre: 'Fernando', conectado: true, aviso: '' },
      { id: 'clara', nombre: 'Clara', conectado: false, aviso: '' },
      { id: 'jorge', nombre: 'Jorge', conectado: false, aviso: '⚠ Tiene 1 día para pagar' },
      { id: 'silvia', nombre: 'Silvia', conectado: true, aviso: '' },
      { id: 'roberto', nombre: 'Roberto', conectado: false, aviso: '' },
      { id: 'patricia', nombre: 'Patricia', conectado: true, aviso: '' },
      { id: 'esteban', nombre: 'Esteban', conectado: false, aviso: '' },
      { id: 'laura2', nombre: 'Laura M.', conectado: false, aviso: '' },
      { id: 'ricardo', nombre: 'Ricardo', conectado: true, aviso: '' },
      { id: 'camila', nombre: 'Camila', conectado: false, aviso: '' },
      { id: 'manuel', nombre: 'Manuel', conectado: false, aviso: '' },
      { id: 'isabel', nombre: 'Isabel', conectado: true, aviso: '' },
      { id: 'javier', nombre: 'Javier', conectado: false, aviso: '' },
      { id: 'gabriela', nombre: 'Gabriela', conectado: true, aviso: '' },
      { id: 'andres', nombre: 'Andrés', conectado: false, aviso: '' },
      { id: 'monica', nombre: 'Mónica', conectado: true, aviso: '' },
    ];

    const linkAcceso = 'https://remotedesktop.google.com/access/session/74f88d06-dcea-b3ee-b410-35d9ab213273';
    const tiempoBloqueo = 2 * 60 * 60 * 1000; // 2 horas en ms
    const tiempoCierre = 10 * 1000; // 10 segundos

    function crearCliente(cliente) {
      const div = document.createElement('div');
      div.className = 'cliente';
      div.id = 'cliente-' + cliente.id;

      const h2 = document.createElement('h2');
      h2.textContent = `Cliente: ${cliente.nombre}`;
      div.appendChild(h2);

      const pEstado = document.createElement('p');
      pEstado.classList.add('estado');
      if(cliente.conectado){
        pEstado.textContent = 'Estado: Conectado';
        pEstado.classList.add('conectado');
      } else {
        pEstado.textContent = 'Estado: Desconectado';
        pEstado.classList.add('desconectado');
      }
      div.appendChild(pEstado);

      const contenedorAvisoBoton = document.createElement('div');
      contenedorAvisoBoton.style.width = '100%';
      contenedorAvisoBoton.style.textAlign = 'center';

      let spanAviso;
      if(cliente.aviso){
        spanAviso = document.createElement('span');
        spanAviso.className = 'aviso';
        spanAviso.textContent = cliente.aviso;
        contenedorAvisoBoton.appendChild(spanAviso);
      }

      if(!cliente.conectado){
        const btn = document.createElement('button');
        btn.className = 'boton-conectar';
        btn.textContent = 'Conectar de nuevo';

        const claveStorage = 'cliente_' + cliente.id + '_ultimoAcceso';
        const ultimoAcceso = localStorage.getItem(claveStorage);
        if(ultimoAcceso){
          const ahora = Date.now();
          if(ahora - parseInt(ultimoAcceso) < tiempoBloqueo){
            btn.textContent = 'Conectado';
            btn.disabled = true;
            if(spanAviso) spanAviso.remove();
          }
        }

        btn.onclick = () => {
          const ultimo = localStorage.getItem(claveStorage);
          const ahora = Date.now();
          if(ultimo && (ahora - parseInt(ultimo) < tiempoBloqueo)){
            alert('No se puede acceder todavía.');
            return;
          }

          localStorage.setItem(claveStorage, ahora);

          // Abrir en nueva pestaña
          const nuevaVentana = window.open(linkAcceso, '_blank');

          // Cambiar estado en la misma pestaña
          pEstado.textContent = 'Estado: Conectado';
          pEstado.classList.remove('desconectado');
          pEstado.classList.add('conectado');

          // Cambiar botón y quitar aviso
          btn.textContent = 'Conectado';
          btn.disabled = true;
          if(spanAviso) spanAviso.remove();

          // Cerrar nueva pestaña en 10 segundos
          setTimeout(() => {
            if(nuevaVentana) {
              nuevaVentana.close();
            }
          }, tiempoCierre);
        };

        contenedorAvisoBoton.appendChild(btn);
      }

      div.appendChild(contenedorAvisoBoton);

      return div;
    }

    function cargarClientes(){
      const panel = document.getElementById('panel-clientes');
      clientes.forEach(cliente => {
        panel.appendChild(crearCliente(cliente));
      });
    }

    cargarClientes();
  </script>
</body>
</html>

